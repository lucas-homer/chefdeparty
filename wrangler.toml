name = "chefdeparty"
main = "src/index.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]

# Static assets from Vite build (using Workers Assets)
[assets]
directory = "./dist"
binding = "ASSETS"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "chefdeparty-db-dev"
database_id = "replace-with-dev-d1-database-id"
migrations_dir = "drizzle/migrations"

# Durable Objects for scheduled reminders
[[durable_objects.bindings]]
name = "PARTY_REMINDER"
class_name = "PartyReminder"

[[migrations]]
tag = "v1"
new_classes = ["PartyReminder"]

# Development environment
[env.dev]
name = "chefdeparty-dev"

[env.dev.vars]
NODE_ENV = "development"

# Production environment
[env.production]
name = "chefdeparty"
routes = [
  { pattern = "chefde.party/*", zone_name = "chefde.party" }
]

[env.production.vars]
NODE_ENV = "production"
APP_URL = "https://chefde.party"

[[env.production.durable_objects.bindings]]
name = "PARTY_REMINDER"
class_name = "PartyReminder"

[[env.production.d1_databases]]
binding = "DB"
database_name = "chefdeparty-db"
database_id = "001567cf-2123-447d-b58b-36159f0d06f1"
migrations_dir = "drizzle/migrations"

# Staging environment
[env.staging]
name = "chefdeparty-staging"
routes = [
  { pattern = "staging.chefde.party/*", zone_name = "chefde.party" }
]

[env.staging.vars]
NODE_ENV = "production"
APP_URL = "https://staging.chefde.party"

[[env.staging.durable_objects.bindings]]
name = "PARTY_REMINDER"
class_name = "PartyReminder"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "chefdeparty-db-staging"
database_id = "136572e0-c5d6-4187-afb0-c3c8f5fc81aa"
migrations_dir = "drizzle/migrations"

# Build configuration for wrangler
[build]
command = "pnpm run build:client"

# Cron triggers for scheduled jobs
[triggers]
crons = ["0 3 * * *"]  # Run at 3 AM UTC daily

# Environment variables (set via wrangler secret or dashboard)
# AUTH_SECRET - Auth.js secret
# AUTH_GOOGLE_ID - Google OAuth client ID
# AUTH_GOOGLE_SECRET - Google OAuth client secret
# GOOGLE_GENERATIVE_AI_API_KEY - Google AI API key
# LANGFUSE_PUBLIC_KEY - Langfuse public key
# LANGFUSE_SECRET_KEY - Langfuse secret key
# RESEND_API_KEY - Resend email API key
# CRON_SECRET - Secret for authenticating cron job requests
# ADMIN_EMAILS - Comma-separated list of admin email addresses
